import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { FaLinkedin, FaGithub, FaEnvelope, FaChartBar, FaBars } from 'react-icons/fa';

// Utility function for smooth scrolling
const scrollToSection = (sectionId) => {
  const element = document.getElementById(sectionId);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' });
  }
};

const Sidebar = ({ activeSection, setActiveSection }) => {
  const [isOpen, setIsOpen] = useState(false);

  const toggleSidebar = () => setIsOpen(!isOpen);

  const handleSetActiveSection = (section) => {
    setActiveSection(section);
    scrollToSection(section);
    if (window.innerWidth < 768) {
      setIsOpen(false);
    }
  };

  return (
    <>
      <button
        className="md:hidden fixed top-4 left-4 z-50 bg-purple-600 text-white p-2 rounded-full shadow-lg"
        onClick={toggleSidebar}
      >
        <FaBars size={24} />
      </button>
      <AnimatePresence>
        {(isOpen || window.innerWidth >= 768) && (
          <motion.aside
            initial={{ x: -250 }}
            animate={{ x: 0 }}
            exit={{ x: -250 }}
            transition={{ duration: 0.3 }}
            className="fixed left-0 top-0 h-screen w-64 bg-gradient-to-b from-orange-400 to-purple-600 text-white p-6 overflow-y-auto z-40"
          >
            <div className="text-center mb-8">
              <img
                src="https://media.licdn.com/dms/image/v2/D5603AQG7Jkifg5XexQ/profile-displayphoto-shrink_400_400/profile-displayphoto-shrink_400_400/0/1685992178343?e=1729123200&v=beta&t=BVyD9hoqNLz-TkNCLvmguyxisZiKDz8JAlZUPWV2pcY"
                alt="Pallavi Handa"
                className="w-32 h-32 rounded-full mx-auto border-4 border-white shadow-lg"
              />
              <h1 className="text-2xl font-bold mt-4">Pallavi Handa</h1>
              <p className="text-sm opacity-75">Data Analyst | Business Analytics Student</p>
            </div>
            <nav>
              <ul>
                {['about', 'experience', 'skills', 'projects', 'education'].map((section) => (
                  <li key={section} className="mb-4">
                    <button
                      onClick={() => handleSetActiveSection(section)}
                      className={`w-full text-left py-2 px-4 rounded transition-all ${
                        activeSection === section
                          ? 'bg-white text-purple-600 font-bold'
                          : 'hover:bg-white/20'
                      }`}
                    >
                      {section.charAt(0).toUpperCase() + section.slice(1)}
                    </button>
                  </li>
                ))}
              </ul>
            </nav>
            <div className="mt-8 flex justify-center space-x-4">
              <a href="mailto:pallavihanda25@gmail.com" className="text-white hover:text-purple-200 transition-colors">
                <FaEnvelope size={24} />
              </a>
              <a href="https://www.linkedin.com/in/pallavi-handa" className="text-white hover:text-purple-200 transition-colors">
                <FaLinkedin size={24} />
              </a>
              <a href="https://github.com/Pallavi-Handa" className="text-white hover:text-purple-200 transition-colors">
                <FaGithub size={24} />
              </a>
              <a href="https://app.powerbi.com/view?r=eyJrIjoiMGM1YjljMGItZTUxNy00NjRlLWEzNzUtZGY0ZjllZTM1MWFlIiwidCI6ImM2ZTU0OWIzLTVmNDUtNDAzMi1hYWU5LWQ0MjQ0ZGM1YjJjNCJ9" className="text-white hover:text-purple-200 transition-colors">
                <FaChartBar size={24} />
              </a>
            </div>
          </motion.aside>
        )}
      </AnimatePresence>
    </>
  );
};

const Section = ({ id, title, children }) => {
  return (
    <motion.section
      id={id}
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
      className="mb-12 scroll-mt-16"
    >
      <h2 className="text-3xl font-bold mb-6 text-purple-600 border-b-2 border-orange-400 pb-2">{title}</h2>
      {children}
    </motion.section>
  );
};

const SkillBar = ({ name, level }) => {
  return (
    <div className="mb-4">
      <div className="flex justify-between mb-1">
        <span className="font-semibold">{name}</span>
        <span>{level}%</span>
      </div>
      <div className="w-full bg-gray-200 rounded-full h-2.5">
        <motion.div
          className="bg-purple-600 h-2.5 rounded-full"
          initial={{ width: 0 }}
          animate={{ width: `${level}%` }}
          transition={{ duration: 1, ease: "easeOut" }}
        />
      </div>
    </div>
  );
};

const ProjectCard = ({ title, tools, date, description, links, images }) => {
  return (
    <motion.div
      whileHover={{ scale: 1.02 }}
      className="bg-white rounded-lg shadow-lg p-6 mb-8"
    >
      <h3 className="text-2xl font-bold mb-2 text-purple-600">{title}</h3>
      <p className="text-sm text-gray-600 mb-2"><strong>Tools:</strong> {tools}</p>
      <p className="text-sm text-gray-600 mb-4"><strong>Completed:</strong> {date}</p>
      <ul className="list-disc list-inside mb-4 text-gray-700">
        {description.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
      <div className="flex flex-wrap gap-2 mb-4">
        {links.map((link, index) => (
          <a
            key={index}
            href={link.url}
            className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors"
            target="_blank"
            rel="noopener noreferrer"
          >
            {link.text}
          </a>
        ))}
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {images.map((image, index) => (
          <img key={index} src={image} alt={`${title} screenshot ${index + 1}`} className="rounded-lg shadow-md" />
        ))}
      </div>
    </motion.div>
  );
};

const Portfolio = () => {
  const [activeSection, setActiveSection] = useState('about');

  useEffect(() => {
    const handleScroll = () => {
      const sections = ['about', 'experience', 'skills', 'projects', 'education'];
      let current = '';

      for (const section of sections) {
        const element = document.getElementById(section);
        if (element) {
          const rect = element.getBoundingClientRect();
          if (rect.top <= 100 && rect.bottom >= 100) {
            current = section;
            break;
          }
        }
      }

      if (current && current !== activeSection) {
        setActiveSection(current);
      }
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, [activeSection]);

  return (
    <div className="bg-gray-100 min-h-screen">
      <Sidebar activeSection={activeSection} setActiveSection={setActiveSection} />
      <main className="md:ml-64 p-8">
        <Section id="about" title="About Me">
          <p className="text-lg text-gray-700">
            Passionate data analyst with a keen eye for detail and a drive for uncovering meaningful insights. Experienced in leveraging data to drive business decisions and optimize processes.
          </p>
        </Section>

        <Section id="experience" title="Experience">
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h3 className="text-xl font-bold mb-2">Data Analyst Intern, Senocare, India (Jun 2021 – Dec 2021)</h3>
            <p className="mb-4">Collaborated with the Client Relations Manager to gather, interpret, and analyze data to extract actionable insights.</p>
            <h4 className="font-bold mb-2">Key Responsibilities:</h4>
            <ul className="list-disc list-inside text-gray-700">
              <li>Design and develop interactive dashboards using Power BI to visualize key performance indicators (KPIs) for elder care services, including:
                <ul className="list-circle list-inside ml-6">
                  <li>Service utilization rates across different care packages, leading to a 20% optimization of resource allocation</li>
                  <li>Client satisfaction scores and feedback trends, contributing to a 12% improvement in overall client satisfaction</li>
                  <li>Patterns and trends in elder care need to inform strategic decision-making and service improvements</li>
                  <li>Cost-based analysis giving insight into the profitability of each service offering</li>
                </ul>
              </li>
              <li>Create reports to monitor service ticket trends and execution timelines, ensuring timely delivery of care services and improving on-time completion rate by 18%</li>
              <li>Utilize MySQL to manage and query large datasets related to client profiles, service history, and health records.</li>
            </ul>
          </div>
        </Section>

        <Section id="skills" title="Skills">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
              <h3 className="text-xl font-bold mb-4">Analytical Tools</h3>
              <SkillBar name="Power BI" level={90} />
              <SkillBar name="Tableau" level={85} />
              <SkillBar name="Advanced Excel" level={95} />
            </div>
            <div>
              <h3 className="text-xl font-bold mb-4">Programming Languages</h3>
              <SkillBar name="SQL" level={90} />
              <SkillBar name="Python" level={80} />
              <SkillBar name="SAS" level={75} />
            </div>
            <div>
              <h3 className="text-xl font-bold mb-4">Database</h3>
              <SkillBar name="MySQL" level={85} />
            </div>
          </div>
        </Section>

        <Section id="projects" title="Projects">
          <ProjectCard
            title="Business 360 - Brick & mortar and e-commerce"
            tools="Power BI | SQL | Excel | Dax Studio"
            date="Aug 2024"
            description={[
              "Customized a multi-functional Power BI dashboard to analyze Nexus hardware's sales trends over the global market by gathering data from 2 different sources (Excel/CSV files and a SQL database).",
              "Built data models and visualizations in Power BI, and optimized the report with DAX studio which improved the report's performance by 5%.",
              "Developed a dashboard that enabled Nexus Hardware to analyze department sales trends, driving a projected 10% revenue acceleration and a 20% reduction in data-related expenses."
            ]}
            links={[
              { text: "GitHub Repo", url: "https://github.com/Pallavi-Handa/portfolio" },
              { text: "Live Dashboard", url: "https://app.powerbi.com/view?r=eyJrIjoiMGM1YjljMGItZTUxNy00NjRlLWEzNzUtZGY0ZjllZTM1MWFlIiwidCI6ImM2ZTU0OWIzLTVmNDUtNDAzMi1hYWU5LWQ0MjQ0ZGM1YjJjNCJ9" }
            ]}
            images={[
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/NEXUS-360_SALES.png",
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/NEXUS-360_Finance.png",
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/NEXUS-360_Marketing.png"
            ]}
          />
          <ProjectCard
            title="Healthcare Provider Analytics"
            tools="Power BI | DAX"
            date="Aug 2024"
            description={[
              "Managed $3M+ in billing data and $1M in out-of-pocket expenses via Power BI, optimizing financial tracking and identifying a 10% potential billing efficiency improvement.",
              "Leveraged DAX and Power Query to analyze billing across 5 departments, visualizing trends by procedure, diagnosis, and service type."
            ]}
            links={[
              { text: "Live Dashboard", url: "https://app.powerbi.com/view?r=eyJrIjoiNjRhNDkyZmEtYWQ3Yi00NDMyLTgyNWUtNDQ5N2MzMDJlNjE2IiwidCI6ImM2ZTU0OWIzLTVmNDUtNDAzMi1hYWU5LWQ0MjQ0ZGM1YjJjNCJ9" }
            ]}
            images={[
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/Healthcare_physicianview.png",
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/Healthcare_revenue(d).png",
              "https://raw.githubusercontent.com/Pallavi-Handa/Pallavi-Handa.github.io/main/Healthcare_revenue(l).png"
            ]}
          />
          <ProjectCard
            title="Cryptocurrency Data Analysis"
            tools="Python | Seaborn | Pandas | Automated extraction"
            date="Jul 2024"
            description={[
              "Developed an automated system to extract and analyze market data for the top 15 cryptocurrencies, collecting 1,500 data points over 100 iterations using the CoinMarketCap API.",
              "Processed and visualized key metrics including price, market cap, volume, and percentage changes using Python, Pandas, and Seaborn, creating 6 different types of visualizations for comprehensive market analysis.",
              "Implemented time series analysis tracking metrics every minute for 100 minutes, providing insights into short-term market behaviors and enabling data-driven decision-making for potential investors."
            ]}
            links={[
              { text: "GitHub Repo", url: "https://github.com/Pallavi-Handa/Automating-Crypto-Report/blob/main/Automating_crypto_website.ipynb" }
            ]}
            images={[]}
          />
          <ProjectCard
            title="Customer Segmentation & Churn Prediction"
            tools="Python | Scikit-Learn | Pandas | Matplotlib"
            date="Jun 2024"
            description={[
              "Developed a customer churn prediction model for the telecom sector using a Random Forest Classifier, achieving an accuracy of 92.4% to help reduce customer attrition.",
              "Performed data cleansing, manipulation, and exploratory data analysis (EDA) with Python libraries such as Pandas and Matplotlib to identify trends and patterns in extensive datasets."
            ]}
            links={[
              { text: "GitHub Repo", url: "https://github.com/Pallavi-Handa/Customer_Churn" }
            ]}
            images={[]}
          />
        </Section>

        <Section id="education" title="Education">
          <div className="space-y-6">
            <div>
              <h3 className="text-xl font-bold mb-2">Academic Background</h3>
              <ul className="list-disc list-inside text-gray-700">
                <li>Seneca College, Canada - Business Analytics (Aug 2024)</li>
                <li>Durham College, Canada - International Business Management (Aug 2023)</li>
                <li>Hansraj College, India - Bachelor of Commerce (Hons) (May 2022)</li>
              </ul>
            </div>
            <div>
              <h3 className="text-xl font-bold mb-2">Certifications</h3>
              <div className="bg-white rounded-lg shadow-lg p-6">
                <h4 className="text-lg font-semibold mb-2">Data Analyst Associate - DataCamp</h4>
                <p className="text-sm text-gray-600 mb-2">Completed: Jan 2024</p>
                <div className="flex space-x-2">
                  <a 
                    href="https://www.datacamp.com/certificate/DAA0019567730341" 
                    className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    View Certificate
                  </a>
                  <a 
                    href="https://www.datacamp.com/datalab/w/6d890b3b-4804-4cb8-a475-7dfcc4d1a0e3" 
                    className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    View DataLab Work
                  </a>
                </div>
              </div>
            </div>
          </div>
        </Section>
      </main>
      <footer className="bg-gray-800 text-white text-center py-4 md:ml-64">
        <p>© 2024 Pallavi Handa. All rights reserved.</p>
      </footer>
    </div>
  );
};

export default Portfolio;
